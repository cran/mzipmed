<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Andrew Sims" />


<title>Introduction to the mzipmed R package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to the <code>mzipmed</code> R
package</h1>
<h4 class="author">Andrew Sims</h4>


<div id="TOC">
<ul>
<li><a href="#brief-introduction-to-counterfactual-approach-to-mediation">Brief
introduction to counterfactual approach to mediation</a></li>
<li><a href="#brief-overview-of-mzip">Brief overview of MZIP</a></li>
<li><a href="#mzipmed_data-overview"><code>mzipmed_data</code>
overview</a></li>
<li><a href="#mzip-function-for-analysis-with-zero-inflated-count-variables"><code>mzip()</code>
function for analysis with zero-inflated count variables</a></li>
<li><a href="#mediation-with-zero-inflated-count-outcomes">Mediation
with Zero-Inflated Count Outcomes</a>
<ul>
<li><a href="#continuous-mediators">Continuous Mediators</a></li>
<li><a href="#binary-mediators">Binary Mediators</a></li>
</ul></li>
<li><a href="#mediation-with-zero-inflated-count-mediators">Mediation
with Zero-Inflated Count Mediators</a>
<ul>
<li><a href="#continuous-outcomes-with-zi-mediators">Continuous Outcomes
with ZI Mediators</a></li>
<li><a href="#binary-outcomes-with-zi-mediators">Binary outcomes with ZI
Mediators</a></li>
</ul></li>
<li><a href="#extensions-of-functions-to-cases-with-exposure-mediator-interactions">Extensions
of functions to cases with exposure-mediator interactions</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<p>In this document we explain the main features of the
<code>mzipmed</code> package through examples. This package performs
mediation analysis when either the outcome or mediator are a count
variable with many zeroes, called a zero-inflated count. Specifically,
this package merges the concepts of the counterfactual approach to
mediation and the marginalized zero-inflated Poisson (MZIP) model to
obtain mediation effects when there are excess zeroes. Additional
information on statistical methodology is provided elsewhere (Long et
al. 2014, Vanderweele 2016)</p>
<div id="brief-introduction-to-counterfactual-approach-to-mediation" class="section level1">
<h1>Brief introduction to counterfactual approach to mediation</h1>
<p>Mediation analysis is used to explore how a variable called a
mediator helps explain the relationship between some exposure and an
outcome. Many popular mediation method such as the difference and
product methods collapse when there are interaction effects or the
outcome is not a continuous variable. The counterfactual approach to
mediation involves finding mediation effects through closed-form
expressions that is extendable to many different classes of models and
can account for interaction effects while minimizing computation speed.
If we let <span class="math inline">\(Y\)</span> be our outcome, <span class="math inline">\(M\)</span> be our mediator, <span class="math inline">\(X\)</span> be our exposure, and <strong><span class="math inline">\(C\)</span></strong> be a vector of covariates. The
counterfactual approach involves fitting two regression models, one for
the outcome and one for the mediator.</p>
<p><span class="math display">\[g(E[Y|X=x,M=m,\textbf{C=c}])=g(E[Y|x,m,c])=\tau_0+\tau_1x+\tau_2m+\mathbf{
\tau_4&#39;c}\]</span> <span class="math display">\[h(E[M|X=x,\textbf{C=c}])=h(E[M|x,c])=\theta_0+\theta_1x++\mathbf{
\theta_4&#39;c}\]</span> Where <span class="math inline">\(g\)</span>
and <span class="math inline">\(h\)</span> are link functions associated
with the outcome and mediator model respectively and <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\theta\)</span> are the parameter estimates
associated with the outcome and mediator model respectively. Using
parameter estimates from these equations mediation effects can be
estimated including the total effect (TE) or the overall effect of the
exposure on the outcome, natural direct effect (NDE) or the effect of
the exposure on the outcome not operating through the mediator, and
natural indirect effect (NIE) or the effect operating through the
mediator. Basic formulas for these equations are as follows <span class="math display">\[NDE=\sum_m(E[Y|x,m,c]-E[Y|x^*,m,c])P(m|x^*,c)\]</span>
<span class="math display">\[NIE=\sum_m(E[Y|x,m,c])(P(m|x,c)-P(m|x^*,c))\]</span>
Where <span class="math inline">\(x^*\)</span> is a fixed value of the
exposure to be compared to <span class="math inline">\(x\)</span>. The
total effect can then be computed as the sum of NDE and NIE on a
difference scale and the product of the NDE and NIE if the outcome is on
a ratio scale.</p>
</div>
<div id="brief-overview-of-mzip" class="section level1">
<h1>Brief overview of MZIP</h1>
<p>Standard count regression models, such as Poisson, give biased
parameter estimates and popular count models like the zero-inflated
Poisson model do not directly provide population average parameter
estimates. In response the marginalized zero-inflated Poisson (MZIP)
model was proposed. MZIP is a mixture distribution that models the
probability of being an excess zero from a Bernoulli distribution with
probability <span class="math inline">\(\psi_i\)</span> and the overall
mean of the distribution from a Poisson distribution with mean <span class="math inline">\(\nu_i\)</span>, where <span class="math inline">\(\nu_i\)</span> is the product of the mean of the
non-excess zeroes, <span class="math inline">\(\mu_i\)</span>, and <span class="math inline">\(1-\psi_i\)</span>. MZIP is fit by <span class="math display">\[logit(\psi_i)=\mathbf{Z_i&#39;\gamma}\]</span>
<span class="math display">\[log(\nu_i)=\mathbf{Z_i&#39;\alpha}\]</span>
Where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\gamma\)</span> are <span class="math inline">\((p\times 1)\)</span> column vectors of parameters
associated with the overall population mean and probability of being an
excess zero models. <span class="math inline">\(\mathbf{Z_i}\)</span> is
a <span class="math inline">\((p\times 1)\)</span> vector of covariates
for the i-th individual for the excess zero and overall population mean
components of MZIP. Exponentiating <span class="math inline">\(\alpha\)</span> parameters yield incidence density
or incidence rate ratio interpretations equivalent to Poisson model
interpretations.</p>
</div>
<div id="mzipmed_data-overview" class="section level1">
<h1><code>mzipmed_data</code> overview</h1>
<p>Included in this package is a simulated dataset for examples called
<code>mzipmed_data</code>. This dataset includes 500 observations of 10
variables. These variables are</p>
<ul>
<li><code>X</code> is a binary exposure simulated from a Bernoulli
distribution with p=0.5</li>
<li><code>C1</code> is a covariate that follows a standard normal
distribution</li>
<li><code>C2</code> is a second covariate from a ~Beta(2,2)</li>
<li><code>ziM</code> is a zero-inflated count mediator simulated from
the predictors <code>X</code>,<code>C1</code>, and <code>C2</code></li>
<li><code>lmM</code> is a continuous mediator based on the predictors
with error term ~N(0,4)</li>
<li><code>binM</code> is a binary mediator based on the predictors
simulated with a Bernoulli distribution</li>
<li><code>lmY</code> is a continuous outcome simulated from
<code>ziM</code> and the predictors with error term ~N(0,4)</li>
<li><code>binY</code> is a binary outcome simulated from
<code>ziM</code> and the predictors with a Bernoulli distribution</li>
<li><code>ziY1</code> is a zero-inflated count outcome simulated from
<code>lmM</code> and the predictors</li>
<li><code>ziY2</code> is a another zero-inflated count outcome, but
instead uses <code>binM</code> and the predictors</li>
</ul>
</div>
<div id="mzip-function-for-analysis-with-zero-inflated-count-variables" class="section level1">
<h1><code>mzip()</code> function for analysis with zero-inflated count
variables</h1>
<p>MZIP can be performed with the <code>mzip()</code> function. For
example, assume we would like to observe how our <code>X</code> is
associated with <code>ziY1</code>from <code>mzipmed_data</code>. First
we need to load the <code>mzipmed</code> package</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mzipmed)</span></code></pre></div>
<p>Next we can use the <code>mzip()</code> function to conduct this
analysis. First we need to specify the <code>y</code> argument which in
our case <code>y=mzipmed_data$ziY1</code>. For the covariates we specify
the <code>pred</code> argument. For a single predictor we could use
<code>pred=mzipmed_data$X</code>. Suppose we adjust for <code>C1</code>
and <code>C2</code> then we bind all the predictors into a vector using
the <code>cbind()</code> function in base R,
e.g. <code>pred=cbind(mzipmed_data$X,mzipmed_data$C1,mzipmed_data$C2)</code>.
If we want our covariates named in the outcome we need to specify within
the <code>cbind()</code> function,
e.g. <code>pred=cbind(X=mzipmed_data$X,C1=mzipmed_data$C1,C2=mzipmed_data$C2)</code>
otherwise they will be named X1,X2,… in order they are included. The
final argument is <code>print=FALSE</code>, if <code>print=TRUE</code>
parameter estimates, standard errors, p-values, and risk ratios will be
printed into the R console. The default is TRUE. Using this example</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>test<span class="ot">=</span><span class="fu">mzip</span>(<span class="at">y=</span>mzipmed_data<span class="sc">$</span>ziY1, <span class="at">pred=</span><span class="fu">cbind</span>(<span class="at">X=</span>mzipmed_data<span class="sc">$</span>X,<span class="at">C1=</span>mzipmed_data<span class="sc">$</span>C1,<span class="at">C2=</span>mzipmed_data<span class="sc">$</span>C2), <span class="at">print=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Overall Mean Estimates from MZIP&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Variable Alpha_Estimate    SE P_Value Robust_SE Robust_P_Value</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 intercept         -0.520 0.200  0.0092     0.237         0.0282</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         X          0.249 0.150  0.0974     0.209         0.2340</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3        C1          0.064 0.069  0.3605     0.073         0.3845</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        C2          0.886 0.322  0.0059     0.366         0.0153</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Excess Zero Estimates from MZIP&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Variable Gamma_Estimate    SE P_Value Robust_SE Robust_P_Value</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 intercept          0.515 0.259  0.0469     0.264         0.0508</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         X          0.288 0.199  0.1495     0.205         0.1614</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3        C1          0.040 0.085  0.6436     0.081         0.6273</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        C2         -0.095 0.410  0.8172     0.399         0.8124</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Overall Mean Incidence Rate Ratio Estimates&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Variable incrate_ratio Lower_CI Upper_CI RobLower_CI RobUpper_CI</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        X         1.283    0.956    1.722       0.851       1.934</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2       C1         1.066    0.930    1.221       0.923       1.230</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3       C2         2.426    1.291    4.558       1.185       4.967</span></span></code></pre></div>
<p>We find no evidence that <code>X</code> is significantly associated
with the outcome and we obtain a relative risk estimate of 1.28. The
robust standard errors are often used if over-dispersion is a concern as
they typically provide wider confidence intervals. In the
<code>test</code> output one can also find covariance matrices,
parameter estimates, confidence intervals, etc.</p>
</div>
<div id="mediation-with-zero-inflated-count-outcomes" class="section level1">
<h1>Mediation with Zero-Inflated Count Outcomes</h1>
<div id="continuous-mediators" class="section level2">
<h2>Continuous Mediators</h2>
<p>Assume we want to examine how a continuous mediator explains the
relationship between an exposure and a zero-inflated count mediator. We
would fit the following models <span class="math display">\[logit(\psi_i|x,m,c)=\gamma_0+\gamma_1x+\gamma_2m+\mathbf{\gamma_4&#39;c}\]</span>
<span class="math display">\[log(\nu_i|x,m,c)=\alpha_0+\alpha_1x+\alpha_2m+\mathbf{\alpha_4&#39;c}\]</span>
<span class="math display">\[E(M|x,c)=\theta_0+\theta_1x+\mathbf{\theta_4&#39;c}\]</span>
The overall mean outcome model is on a incidence rate ratio (IRR) scale
so NDE and NIE estimates will be as well and can be computed by <span class="math display">\[IRR^{NDE}=e^{\alpha_1(x-x^*)}\]</span> <span class="math display">\[IRR^{NIE}=e^{\alpha_2\theta_1(x-x^*)}\]</span> To
conduct this mediation analysis in the <code>mzipmed</code> package we
would use the <code>zioutlmmed()</code> function. This functions only
allows for a single outcome, mediator, and exposure at a time. Using the
<code>mzipmed</code> data let <span class="math inline">\(X=X\)</span>
and <span class="math inline">\(M=lmM\)</span> and our outcome is
<code>ziY1</code>. We specify these variables with the following
arguments
<code>outcome=mzipmed_data$ziY1</code>,<code>mediator=mzipmed_data$lmM</code>,
<code>exposure=mzipmed_data$X</code>, and for the covariates/confounders
<code>confounder=cbind(mzipmed_data$C1,mzipmed_data$C2</code>). Standard
errors can be computed using bootstrapping which is robust, but
computationally intensive or via delta method for instantaneous variance
estimation. For delta method use <code>error=&quot;Delta&quot;</code> which is the
default and for bootstrap use <code>error=&quot;Boot&quot;</code>. Robust standard
errors can be requested within the delta method to be used for concerns
of over-dispersion by specifying <code>robust=TRUE</code>; FALSE is the
default. We also need to input values of the exposure to compare to
using the <code>X</code> and <code>Xstar</code> arguments, for a
dummy-coded binary exposure and by default we let <code>X=1</code> and
<code>Xstar=0</code>. These can be changed as needed. For bootstrap
standard error you can specify the number of iterations, by default
there are 1000 repetitions, <code>n=1000</code>. As an example</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ziout<span class="ot">=</span><span class="fu">zioutlmmed</span>(<span class="at">outcome=</span>mzipmed_data<span class="sc">$</span>ziY1,<span class="at">mediator=</span>mzipmed_data<span class="sc">$</span>lmM,<span class="at">exposure=</span>mzipmed_data<span class="sc">$</span>X, <span class="at">confounder=</span><span class="fu">cbind</span>(mzipmed_data<span class="sc">$</span>C1,mzipmed_data<span class="sc">$</span>C2), <span class="at">error=</span><span class="st">&quot;Delta&quot;</span>, <span class="at">robust=</span><span class="cn">FALSE</span>,<span class="at">X=</span><span class="dv">1</span>,<span class="at">Xstar=</span><span class="dv">0</span>,<span class="at">n=</span><span class="dv">1000</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                               Estimate log SE Lower CI Upper CI</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Direct Effect (IRR)      1.021  0.147    0.766    1.361</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Indirect Effect (IRR)    1.163  0.068    1.018    1.328</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total Effect (IRR)               1.187  0.162    0.865    1.630</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportion Mediated              0.889</span></span></code></pre></div>
<p>Printed into the R console are the incidence rate ratios of the NDE,
NIE, and TE along with their standard errors and confidence intervals
and the proportion mediated. From the ziout data we see no evidence of a
significant direct effect of the exposure on the outcome as the
incidence rate ratio includes 1 in the confidence interval, but do see
that a significant effect operating through the mediator since 1 is not
in the confidence interval. Additional information in the ziout in the R
global environment include all information included in the outcome model
using <code>mzip()</code> and the mediator model using <code>lm()</code>
from the <code>stats</code> package in base R.</p>
</div>
<div id="binary-mediators" class="section level2">
<h2>Binary Mediators</h2>
<p>The <code>mzip</code> package also includes a function for mediation
with zero-inflated count outcomes and binary mediators. For this
procedure a MZIP model is fit for the outcome and a logistic regression
is fit for the mediator model using the <code>glm()</code> function in
base R. The aforementioned function is called
<code>zioutbinmed()</code>. The NDE is the same as with continuous
mediators, but the NIE is now conditional on covariates</p>
<p><span class="math display">\[IRR^{NIE}=\frac{([1+e^{\theta_0+\theta_1x^*+\mathbf{\theta_2&#39;c}}][1+e^{\alpha_2
\theta_0+\theta_1x+\mathbf{\theta_2&#39;c}}])}{([1+e^{\theta_0+\theta_1x+\mathbf{\theta_2&#39;c}}][1+e^{\alpha_2\theta_0+\theta_1x^*+\mathbf{\theta_2&#39;c}}])}\]</span>
Therefore fixed values of the covariates are required. The input for the
<code>zioutbinmed()</code> function is the same as in the previous
section, but also includes an argument to specify these covariates
called <code>C</code>. By default, <code>C=NULL</code> each covariate
will be fixed at its mean value to approximate marginal estimates, but
can be changed using for example <code>C=c(0,2)</code>. The remainder of
the input and output for this function is the same as with the a
continuous mediator and we now use
<code>outcome=mzipmed_data$ziY2</code> for the outcome variable.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>zioutb<span class="ot">=</span><span class="fu">zioutbinmed</span>(<span class="at">outcome=</span>mzipmed_data<span class="sc">$</span>ziY2,<span class="at">mediator=</span>mzipmed_data<span class="sc">$</span>binM,  <span class="at">exposure=</span>mzipmed_data<span class="sc">$</span>X, <span class="at">confounder=</span><span class="fu">cbind</span>(mzipmed_data<span class="sc">$</span>C1,mzipmed_data<span class="sc">$</span>C2), <span class="at">error=</span><span class="st">&quot;Delta&quot;</span>,  <span class="at">robust=</span><span class="cn">FALSE</span>,<span class="at">X=</span><span class="dv">1</span>, <span class="at">Xstar=</span><span class="dv">0</span>, <span class="at">n=</span><span class="dv">1000</span>, <span class="at">C=</span><span class="cn">NULL</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                               Estimate log SE Lower CI Upper CI</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Direct Effect (IRR)      1.267  0.138    0.966    1.661</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Indirect Effect (IRR)    1.008  0.011    0.987    1.029</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total Effect (IRR)               1.277  0.138    0.974    1.674</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportion Mediated              0.037</span></span></code></pre></div>
</div>
</div>
<div id="mediation-with-zero-inflated-count-mediators" class="section level1">
<h1>Mediation with Zero-Inflated Count Mediators</h1>
<div id="continuous-outcomes-with-zi-mediators" class="section level2">
<h2>Continuous Outcomes with ZI Mediators</h2>
<p>Assume we have a continuous outcome, <span class="math inline">\(Y\)</span>, and a zero-inflated count mediator
<span class="math inline">\(M\)</span>. We fit a linear regression
outcome model and a MZIP mediator model as follows: <span class="math display">\[E(Y|x,m,c)=\beta_0+\beta_1x+\beta_2m+\mathbf{\beta_4&#39;c}\]</span>
<span class="math display">\[logit(\psi_i(M)|x,c)=\gamma_0+\gamma_1x+\mathbf{\gamma_4&#39;c}\]</span>
<span class="math display">\[log(\nu_i(M)|x,c)=\alpha_0+\alpha_1x+\mathbf{\alpha_4&#39;c}\]</span>
Because the outcome is on a difference scale, so will the NDE and NIE
estimates which can be derived by <span class="math display">\[\beta_1(x-x^*)\]</span> <span class="math display">\[\beta_2[e^{\alpha_0+\alpha_1x+\mathbf{\alpha_4&#39;c}}-e^{\alpha_0+\alpha_1x^*+\mathbf{\alpha_4&#39;c}}]\]</span>
For this mediation analysis the <code>lmoutzimed()</code> function could
be used. For example with the <code>mzipmed_data</code> we assume the
same set of predictors as in the section with ZI outcomes, but now let
<code>mediator=mzipmed_data$ziM</code> and
<code>outcome=mzipmed_data=lmY</code>. Input required is the same as in
the section for ZI outcomes with the <code>C</code> argument shown in
the ZI outcomes with binary mediators example and this function uses the
<code>lm()</code> function for the outcome variable and the
<code>mzip()</code> function for the mediator model with all effects
being on a difference scale. For example,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>zimed<span class="ot">=</span><span class="fu">lmoutzimed</span>(<span class="at">outcome=</span>mzipmed_data<span class="sc">$</span>lmY,<span class="at">mediator=</span>mzipmed_data<span class="sc">$</span>ziM, <span class="at">exposure=</span>mzipmed_data<span class="sc">$</span>X, <span class="at">confounder=</span><span class="fu">cbind</span>(mzipmed_data<span class="sc">$</span>C1,mzipmed_data<span class="sc">$</span>C2),<span class="at">error=</span><span class="st">&quot;Delta&quot;</span>, <span class="at">robust=</span><span class="cn">FALSE</span>,<span class="at">X=</span><span class="dv">1</span>,<span class="at">Xstar=</span><span class="dv">0</span>,<span class="at">C=</span><span class="cn">NULL</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         Estimate     SE Lower CI Upper CI</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Direct Effect      1.388  0.366    0.670    2.106</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Indirect Effect    0.072  0.049   -0.025    0.169</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total Effect               1.460  0.367    0.741    2.179</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportion Mediated        0.049</span></span></code></pre></div>
<p>After running the function we can see in the R console that the NDE
is statistically significant as the mean difference does not include 0
in the confidence interval, but the NIE is not significant because it
includes 0. Additional information on the individual outcome and
mediator models can be found in the <code>zimed</code> data now in the
global environment.</p>
</div>
<div id="binary-outcomes-with-zi-mediators" class="section level2">
<h2>Binary outcomes with ZI Mediators</h2>
<p>For binary outcomes we do not use a logistic regression outcome model
because of the non-collapsability of logit-links makes deriving closed
form expression of NDE and NIE impossible so in this package we use a
Poisson outcome model with a log-link with robust variance estimates
using the <code>glmrob()</code> function in the <code>robust</code>
package. Assuming the same input as in the section for continuous
outcomes, but now <code>outcome=mzipmed_data$binY</code>and NDE and NIE
estimates will now be on a ratio scale because of the Poisson outcome
model. The outcome model will be</p>
<p><span class="math display">\[log[P(Y_i=1|x,m,c)]=\tau_0+\tau_1x+\tau_2m+\mathbf{\tau_4&#39;c}\]</span></p>
<p>The same MZIP mediator model can be used as shown in the previous
section. Risk ratios of NDE and NIE can be derived as displayed
below.</p>
<p><span class="math display">\[RR^{NDE}=e^{\tau_1(x-x^*)}\]</span>
<span class="math display">\[RR^{NIE}=\frac{(1+e^{\gamma_0+\gamma_1x^*+\mathbf{\gamma_4&#39;c}})(e^{\gamma_0+\gamma_1x+\mathbf{\gamma_4&#39;c}}+e^{(e^{\alpha_0+\alpha_1x+\mathbf{\alpha_4&#39;c}+log(1+e^{\gamma_0+\gamma_1x+\mathbf{\gamma_4&#39;c}})})(e^{\tau_2}-1)}}{(1+e^{\gamma_0+\gamma_1x+\mathbf{\gamma_4&#39;c}})(e^{\gamma_0+\gamma_1x^*+\mathbf{\gamma_4&#39;c}}+e^{(e^{\alpha_0+\alpha_1x^*+\mathbf{\alpha_4&#39;c}+log(1+e^{\gamma_0+\gamma_1x^*+\mathbf{\gamma_4&#39;c}})})(e^{\tau_2}-1)}}\]</span></p>
<p>For this scenario we will use the <code>binoutzimed()</code>
function. For example,</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>zimedb<span class="ot">=</span><span class="fu">binoutzimed</span>(<span class="at">outcome=</span>mzipmed_data<span class="sc">$</span>binY,<span class="at">mediator=</span>mzipmed_data<span class="sc">$</span>ziM, <span class="at">exposure=</span>mzipmed_data<span class="sc">$</span>X, <span class="at">confounder=</span><span class="fu">cbind</span>(mzipmed_data<span class="sc">$</span>C1,mzipmed_data<span class="sc">$</span>C2),<span class="at">error=</span><span class="st">&quot;Delta&quot;</span>, <span class="at">robust=</span><span class="cn">FALSE</span>,<span class="at">X=</span><span class="dv">1</span>,<span class="at">Xstar=</span><span class="dv">0</span>,<span class="at">C=</span><span class="cn">NULL</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                              Estimate log SE Lower CI Upper CI</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Direct Effect (RR)      1.351  0.136    1.035    1.765</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Indirect Effect (RR)    1.030  0.021    0.987    1.074</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total Effect (RR)               1.391  0.137    1.064    1.819</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportion Mediated             0.102</span></span></code></pre></div>
<p>Input and output are all the same as in the section with continuous
outcomes, except effects being on a ratio scale. For the zimedb example
we find a significant NDE as 1 is not included in the risk ratio
confidence interval, but fail to observe a significant NIE.</p>
</div>
</div>
<div id="extensions-of-functions-to-cases-with-exposure-mediator-interactions" class="section level1">
<h1>Extensions of functions to cases with exposure-mediator
interactions</h1>
<p>The <code>mzipmed</code> package extends all the previous functions
to cases where you are considering if there is an exposure-mediator
interaction. In addition to the NDE and NIE additional quantities can be
computed including the controlled direct effect (CDE), pure indirect
effect (PIE), interactive reference effect (INTref), and interaction
mediation effect (INTmed) which are the exposure-outcome relationship
due to neither mediation nor interaction, only mediation, only
interaction, and the tandem effect of mediation and interaction
respectively. The interaction effects are for additive interactions,
multiplicative interactions can be assessed directly in the outcome
model. Also computed is the proportion eliminated (PE) which answers the
question ‘if we were to fix the mediator to some value how much of the
exposure differences in the outcome could be eliminated?’.</p>
<p>The functions to do this are as follows: for a continuous outcome and
zero-inflated mediator use <code>lmoutzimedint</code>, for a binary
outcome and ZI mediator use <code>binoutzimedint</code>, for a ZI
outcome and continuous mediator use <code>zioutlmmedint</code>, and for
a ZI outcome with a binary mediator use <code>zioutbinmedint</code>. We
will skip model expression and formulas for effects, but they are
available upon request. Instead we will show an example using
<code>zioutlmmedint</code>. These functions have the same input as their
non-interaction counterparts, but also require an additional argument in
<code>M</code> which is a fixed value of the mediator used to compute
CDE, INTref, INTmed, and PE. By default, <code>M=NULL</code> the mean
value of the mediator is used, but can be altered e.g. <code>M=0</code>.
Running the function will print the NDE, NIE, and TE in R console like
before as well as the other 4 effects, the overall additive interaction
effect, and PM, PE, and the proportion attributable to interaction.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>zimout<span class="ot">=</span><span class="fu">zioutlmmedint</span>(<span class="at">outcome=</span>mzipmed_data<span class="sc">$</span>ziY1,<span class="at">mediator=</span>mzipmed_data<span class="sc">$</span>lmM, <span class="at">exposure=</span>mzipmed_data<span class="sc">$</span>X, <span class="at">confounder=</span><span class="fu">cbind</span>(mzipmed_data<span class="sc">$</span>C1,mzipmed_data<span class="sc">$</span>C2),<span class="at">error=</span><span class="st">&quot;Delta&quot;</span>, <span class="at">robust=</span><span class="cn">FALSE</span>,<span class="at">X=</span><span class="dv">1</span>,<span class="at">Xstar=</span><span class="dv">0</span>,<span class="at">M=</span><span class="cn">NULL</span>,<span class="at">C=</span><span class="cn">NULL</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                Estimate log SE Lower CI Upper CI</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Direct Effect (IRR)       1.105  0.241    0.689    1.772</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Natural Indirect Effect (IRR)     1.186  0.079    1.017    1.384</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total Effect (IRR)                1.311  0.266    0.778    2.208</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                 </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4-way Decomposition                                             </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Controlled Direct Effect (IRR)    0.990  0.148    0.741    1.323</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Pure Indirect Effect (IRR)        1.145  0.063    1.011    1.296</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Interactive Reference Effect      0.132  0.053    0.028    0.235</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Interactive Mediation Effect      0.071  0.073   -0.072    0.213</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total Additive Interaction        0.202  0.107   -0.007    0.411</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                 </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportions                                                     </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportion Mediated               0.662                         </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportion Eliminated             1.032                         </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Proportion from Interaction       0.562</span></span></code></pre></div>
<p>From this example we fail to see a significant NDE, but do have a
significant mediation effect based on incidence rate ratio
interpretations. The interaction effects are on a difference scale
regardless of the scale of the outcome variable so because 0 is included
in the total additive interaction confidence interval we can conclude
that we do not have evidence of a significant additive interaction
effect between the exposure and mediator on the outcome. Investigating
further into the zimout data in the global environment proportions
attributable to each of the decomposed effects are provided. Because the
interaction was not significant, it would be recommended to use the
function that does not include the interaction term. It is always useful
to check for an interaction effect initially.</p>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>This package provides functions for conducting mediation analysis for
zero-inflated count variables using MZIP. This document serves as a
brief overview of the package. For more information feel free to contact
the package maintainer directly.</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Long DL, Preisser JS, Herring AH, Golin CE. A marginalized
zero-inflated Poisson regression model with overall exposure effects.
Stat Med. 2014;33(29):5151-5165. <a href="doi:10.1002/sim.6293" class="uri">doi:10.1002/sim.6293</a></p>
<p>VanderWeele T. Explanation in Causal Inference: Methods for Mediation
and Interaction. Oxford University Press; 2016.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
